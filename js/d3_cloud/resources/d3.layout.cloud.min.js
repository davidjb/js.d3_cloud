(function(x){function g(){var M=[256,256],z=null,K=r,A=s,L=b,D=k,I=k,E=t,J=n,F=u,H=[],G=Infinity,c=d3.dispatch("word","end"),y=null,B={};B.start=function(){var P=m((M[0]>>5)*M[1]),R=null,T=H.length,O=-1,N=[],S=H.map(function(V,U){return{text:K.call(this,V,U),font:A.call(this,V,U),style:D.call(this,V,U),weight:I.call(this,V,U),rotate:E.call(this,V,U),size:~~L.call(this,V,U),padding:n.call(this,V,U)}}).sort(function(V,U){return U.size-V.size});if(y){clearInterval(y)}y=setInterval(Q,0);Q();return B;function Q(){var V=+new Date,U;while(+new Date-V<G&&++O<T&&y){U=S[O];if(z){U.x=z[0];U.y=z[1]}else{U.x=(M[0]*(Math.random()+0.5))>>1;U.y=(M[1]*(Math.random()+0.5))>>1}q(U,S,O);if(C(P,U,R)){N.push(U);c.word(U);if(R){i(R,U)}else{R=[{x:U.x+U.x0,y:U.y+U.y0},{x:U.x+U.x1,y:U.y+U.y1}]}U.x-=M[0]>>1;U.y-=M[1]>>1}}if(O>=T){B.stop();c.end(N,R)}}};B.stop=function(){if(y){clearInterval(y);y=null}return B};B.timeInterval=function(N){if(!arguments.length){return G}G=N==null?Infinity:N;return B};function C(R,ak,Q){var O=[{x:0,y:0},{x:M[0],y:M[1]}],ai=ak.x,ah=ak.y,N=Math.sqrt(M[0]*M[0]+M[1]*M[1]),Y=F(M),Z=Math.random()<0.5?1:-1,X=-Z,ae,W,U;while(ae=Y(X+=Z)){W=~~ae[0];U=~~ae[1];if(Math.min(W,U)>N){break}ak.x=ai+W;ak.y=ah+U;if(ak.x+ak.x0<0||ak.y+ak.y0<0||ak.x+ak.x1>M[0]||ak.y+ak.y1>M[1]){continue}if(!Q||!j(ak,R,M[0])){if(!Q||f(ak,Q)){var ac=ak.sprite,V=ak.width>>5,ab=M[0]>>5,P=ak.x-(V<<4),aa=P&127,aj=32-aa,ag=ak.y1-ak.y0,T=(ak.y+ak.y0)*ab+(P>>5),S;for(var ad=0;ad<ag;ad++){S=0;for(var af=0;af<=V;af++){R[T+af]|=(S<<aj)|(af<V?(S=ac[ad*V+af])>>>aa:0)}T+=ab}delete ak.sprite;return true}}}return false}B.words=function(N){if(!arguments.length){return H}H=N;return B};B.size=function(N){if(!arguments.length){return M}M=[+N[0],+N[1]];return B};B.startPoint=function(N){if(!arguments.length){return z}z=[+N[0],+N[1]];return B};B.font=function(N){if(!arguments.length){return A}A=d3.functor(N);return B};B.fontStyle=function(N){if(!arguments.length){return D}D=d3.functor(N);return B};B.fontWeight=function(N){if(!arguments.length){return I}I=d3.functor(N);return B};B.rotate=function(N){if(!arguments.length){return E}E=d3.functor(N);return B};B.text=function(N){if(!arguments.length){return K}K=d3.functor(N);return B};B.spiral=function(N){if(!arguments.length){return F}F=a[N+""]||N;return B};B.fontSize=function(N){if(!arguments.length){return L}L=d3.functor(N);return B};B.padding=function(N){if(!arguments.length){return J}J=d3.functor(N);return B};return d3.rebind(B,c,"on")}function r(c){return c.text}function s(){return"serif"}function k(){return"normal"}function b(c){return Math.sqrt(c.value)}function t(){return(~~(Math.random()*6)-3)*30}function n(){return 1}function q(V,W,T){if(V.sprite){return}v.clearRect(0,0,(e<<5)/h,l/h);var E=0,D=0,G=0,L=W.length;T--;while(++T<L){V=W[T];v.save();v.font=V.style+" "+V.weight+" "+~~((V.size+1)/h)+"px "+V.font;var F=v.measureText(V.text+"m").width*h,S=V.size<<1;if(V.rotate){var O=Math.sin(V.rotate*w),C=Math.cos(V.rotate*w),z=F*C,H=F*O,U=S*C,B=S*O;F=(Math.max(Math.abs(z+B),Math.abs(z-B))+31)>>5<<5;S=~~Math.max(Math.abs(H+U),Math.abs(H-U))}else{F=(F+31)>>5<<5}if(S>G){G=S}if(E+F>=(e<<5)){E=0;D+=G;G=0}if(D+S>=l){break}v.translate((E+(F>>1))/h,(D+(S>>1))/h);if(V.rotate){v.rotate(V.rotate*w)}v.fillText(V.text,0,0);v.restore();V.width=F;V.height=S;V.xoff=E;V.yoff=D;V.x1=F>>1;V.y1=S>>1;V.x0=-V.x1;V.y0=-V.y1;E+=F}var I=v.getImageData(0,0,(e<<5)/h,l/h).data,K=[];while(--T>=0){V=W[T];var F=V.width,A=F>>5,S=V.y1-V.y0,J=V.padding;for(var R=0;R<S*A;R++){K[R]=0}E=V.xoff;if(E==null){return}D=V.yoff;var c=0,Q=-1;for(var P=0;P<S;P++){for(var R=0;R<F;R++){var N=A*P+(R>>5),M=I[((D+P)*(e<<5)+(E+R))<<2]?1<<(31-(R%32)):0;if(J){if(P){K[N-A]|=M}if(P<F-1){K[N+A]|=M}M|=(M<<1)|(M>>1)}K[N]|=M;c|=M}if(c){Q=P}else{V.y0++;S--;P--;D++}}V.y1=V.y0+Q;V.sprite=K.slice(0,(V.y1-V.y0)*A)}}function j(J,C,G){G>>=5;var I=J.sprite,F=J.width>>5,c=J.x-(F<<4),E=c&127,B=32-E,A=J.y1-J.y0,D=(J.y+J.y0)*G+(c>>5),H;for(var y=0;y<A;y++){H=0;for(var z=0;z<=F;z++){if(((H<<B)|(z<F?(H=I[y*F+z])>>>E:0))&C[D+z]){return true}}D+=G}return false}function i(z,A){var y=z[0],c=z[1];if(A.x+A.x0<y.x){y.x=A.x+A.x0}if(A.y+A.y0<y.y){y.y=A.y+A.y0}if(A.x+A.x1>c.x){c.x=A.x+A.x1}if(A.y+A.y1>c.y){c.y=A.y+A.y1}}function f(y,c){return y.x+y.x1>c[0].x&&y.x+y.x0<c[1].x&&y.y+y.y1>c[0].y&&y.y+y.y0<c[1].y}function u(c){var y=c[0]/c[1];return function(z){return[y*(z*=0.1)*Math.cos(z),z*Math.sin(z)]}}function p(B){var z=4,A=z*B[0]/B[1],c=0,C=0;return function(D){var y=D<0?-1:1;switch((Math.sqrt(1+4*y*D)-y)&3){case 0:c+=A;break;case 1:C+=z;break;case 2:c-=A;break;default:C-=z;break}return[c,C]}}function m(z){var c=[],y=-1;while(++y<z){c[y]=0}return c}var w=Math.PI/180,e=1<<11>>5,l=1<<11,d,h=1;if(typeof document!=="undefined"){d=document.createElement("canvas");d.width=1;d.height=1;h=Math.sqrt(d.getContext("2d").getImageData(0,0,1,1).data.length>>2);d.width=(e<<5)/h;d.height=l/h}else{var o=require("canvas");d=new o(e<<5,l)}var v=d.getContext("2d"),a={archimedean:u,rectangular:p};v.fillStyle="red";v.textAlign="center";x.cloud=g})(typeof exports==="undefined"?d3.layout||(d3.layout={}):exports);
